<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="">
  
  <meta name="author" content="Steve Westenbroek, John Engott, Vic Kelson, Randall Hunt">
  <link rel="icon" href="../favicon.png">

  <title>grid_Transform &ndash; SWB2</title>

  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/pygments.css" rel="stylesheet">
  <link href="../css/font-awesome.min.css" rel="stylesheet">
  <link href="../css/bootstrap-toc.css" rel="stylesheet">
    <!-- <link href="../css/local.css" rel="stylesheet"> -->
  
  

  <script src="../js/jquery-2.1.3.min.js"></script>
  <script src="../js/svg-pan-zoom.min.js"></script>
  <script src="../js/bootstrap-toc.js"></script>

</head>

<body data-spy="scroll" data-target="#toc">

  <!-- Fixed navbar -->
  <nav class="navbar navbar-expand-lg fixed-top navbar-light bg-light">

    <a class="navbar-brand" href="../index.html">SWB2</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" navbar-light bg-light id="navbarText">
      <ul class="navbar-nav mr-auto">

        
          <li class="nav-item">
            <a class="nav-link" href="../page/index.html">User Guide</a>
          </li>
        

        
          <li class="nav-item">
            <a class="nav-link" href="../lists/modules.html">Modules</a>
          </li>
        

        

        
          <li class="nav-item">
            <a class="nav-link" href="../lists/procedures.html">Procedures</a>
          </li>
        

        
          <li class="nav-item">
            <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
          </li>
        


      </ul>
    </div>

    <form class="form-inline">
      <input class="form-control mr-sm-2" type="text" placeholder="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
        <!-- <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Contents <span class="caret"></span></a>
            <ul class="dropdown-menu"> -->
          <!-- 
            
              <li><a href="../lists/files.html">Source Files</a></li>
            
          
          
            <li><a href="../lists/modules.html">Modules</a></li>
          
          
          
            <li><a href="../lists/procedures.html">Procedures</a></li>
          
          
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
           
            <li><a href="../lists/types.html">Derived Types</a></li>
          
          
            <li><a href="../lists/programs.html">Programs</a></li>
          
        </ul> -->

      <!-- </div> -->
      <!--/.nav-collapse -->

  </nav>

  <div class="container">
    
  
  <div class="row">
    <h1>grid_Transform
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="card">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.3% of total for procedures.">28 statements</a>
     </li>
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/grid.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/grid.f90.html'>grid.F90</a></li>
    
     <li><a href='../module/grid.html'>grid</a></li>
    
  
     <li class="active">grid_Transform</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>

  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>

























<div class="card bg-primary">
  <div class="card-heading text-left"><h3 class="card-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/grid_transform.html#src">grid_Transform</a>
  </div>
</div>



</div>

    </div>

    <div class="col-md-9" id='text'>
    <h2>
public subroutine grid_Transform(pGrd, sFromPROJ4, sToPROJ4)
    
    
   
</h2>
    
  


    
    <p>Call PROJ4 to transform coordinates.
 @details This subroutine calls a Fortran wrapper to the C library
 PROJ4. A set of input coordinates is transformed to the base SWB
 coordinate system.</p>
<p>The idea is to first create a 2D array of the X and Y coordinates in
 the projection system of the input data set. These coordinate values are
 then fed to PROJ4, which modifies the values and returns the coordinate
 values in the projection system of the base grid. Thereafter, mapping
 source to target is a matter of finding the value of the cell closest to
 a SWB grid coordinate pair.
 @param[inout] pGrd
 @param[in] sFromPROJ4
 @param[in] sToPROJ4</p>
<p>calculate X and Y for the untransformed data</p>
<p>PROJ4 expects unprojected coordinates (i.e. lat lon) to be provided
 in RADIANS. Therefore, we convert to radians prior to the call...</p>
<p>If the coordinates have been converted TO latlon, convert back to degrees</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-pgrd~16"></span>type(<a href='../type/general_grid_t.html'>GENERAL_GRID_T</a>),</td>
  <td></td>
  <td></td>
  
  <td>pointer</td><td>::</td>
  <td><strong>pGrd</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-sfromproj4"></span>character(len=*)</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>sFromPROJ4</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-stoproj4"></span>character(len=*)</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>sToPROJ4</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    
     
    <br>

    <!-- <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>

























<div class="card bg-primary">
  <div class="card-heading text-left"><h3 class="card-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/grid_transform.html#src">grid_Transform</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md"> -->

    

    

    

    

    

    

    


    

    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">grid_Transform</span><span class="p">(</span><span class="n">pGrd</span><span class="p">,</span> <span class="n">sFromPROJ4</span><span class="p">,</span> <span class="n">sToPROJ4</span> <span class="p">)</span>

  <span class="k">type</span> <span class="p">(</span> <span class="n">GENERAL_GRID_T</span> <span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">pGrd</span>
  <span class="kt">character</span> <span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sFromPROJ4</span><span class="p">,</span> <span class="n">sToPROJ4</span>
  <span class="kt">character</span> <span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sFromPROJ4</span><span class="p">))</span> <span class="kd">::</span> <span class="n">csFromPROJ4</span>
  <span class="kt">character</span> <span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="kt">C_CHAR</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">sToPROJ4</span><span class="p">))</span> <span class="kd">::</span> <span class="n">csToPROJ4</span>

  <span class="c">! [ LOCALS ]</span>
  <span class="kt">integer</span> <span class="p">(</span><span class="kt">c_int</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iRetVal</span>
  <span class="kt">integer</span> <span class="p">(</span><span class="kt">c_int</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>
  <span class="kt">logical</span> <span class="p">(</span><span class="kt">c_bool</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">iNY</span><span class="p">,</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">iNX</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lMask</span>

  <span class="c">!&gt; calculate X and Y for the untransformed data</span>
  <span class="k">call </span><span class="n">grid_PopulateXY</span><span class="p">(</span><span class="n">pGrd</span><span class="p">)</span>

  <span class="n">csFromPROJ4</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sFromPROJ4</span><span class="p">)</span>
  <span class="n">csToPROJ4</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sToPROJ4</span><span class="p">)</span>

  <span class="c">!&gt; PROJ4 expects unprojected coordinates (i.e. lat lon) to be provided</span>
  <span class="c">!&gt; in RADIANS. Therefore, we convert to radians prior to the call...</span>

  <span class="k">if</span> <span class="p">(</span>      <span class="p">(</span> <span class="n">csFromPROJ4</span> <span class="p">.</span><span class="n">containssimilar</span><span class="p">.</span> <span class="s2">&quot;latlon&quot;</span> <span class="p">)</span>            <span class="p">&amp;</span>
       <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span> <span class="n">csFromPROJ4</span> <span class="p">.</span><span class="n">containssimilar</span><span class="p">.</span> <span class="s2">&quot;latlong&quot;</span> <span class="p">)</span>           <span class="p">&amp;</span>
       <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span> <span class="n">csFromPROJ4</span> <span class="p">.</span><span class="n">containssimilar</span><span class="p">.</span> <span class="s2">&quot;lonlat&quot;</span> <span class="p">)</span>            <span class="p">&amp;</span>
       <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span> <span class="n">csFromPROJ4</span> <span class="p">.</span><span class="n">containssimilar</span><span class="p">.</span> <span class="s2">&quot;longlat&quot;</span> <span class="p">)</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">    </span><span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span> <span class="o">=</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span> <span class="o">*</span> <span class="n">DEGREES_TO_RADIANS</span>
    <span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span> <span class="o">=</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span> <span class="o">*</span> <span class="n">DEGREES_TO_RADIANS</span>

  <span class="n">endif</span>

  <span class="n">iRetVal</span> <span class="o">=</span> <span class="n">pj_init_and_transform</span><span class="p">(</span><span class="n">csFromPROJ4</span><span class="o">//</span><span class="nb">C_NULL_CHAR</span><span class="p">,</span> <span class="p">&amp;</span>
                                  <span class="n">csToPROJ4</span><span class="o">//</span><span class="nb">C_NULL_CHAR</span><span class="p">,</span>   <span class="p">&amp;</span>
                                  <span class="err">__</span><span class="n">SRCNAME__</span><span class="o">//</span><span class="nb">C_NULL_CHAR</span><span class="p">,</span>    <span class="p">&amp;</span>
                                  <span class="err">__</span><span class="n">LINE__</span><span class="p">,</span>                 <span class="p">&amp;</span>
                                  <span class="nb">int</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">iNumGridCells</span><span class="p">,</span> <span class="kt">c_long</span><span class="p">),</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span><span class="p">,</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span><span class="p">)</span>

  <span class="k">call </span><span class="n">grid_CheckForPROJ4Error</span><span class="p">(</span><span class="n">iRetVal</span><span class="p">,</span> <span class="n">sFromPROJ4</span><span class="p">,</span> <span class="n">sToPROJ4</span><span class="p">)</span>


  <span class="c">!&gt; If the coordinates have been converted TO latlon, convert back to degrees</span>

  <span class="k">if</span><span class="p">(</span> <span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">csToPROJ4</span><span class="p">,</span> <span class="n">substring</span><span class="o">=</span><span class="s2">&quot;latlon&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">&amp;</span>
      <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">csToPROJ4</span><span class="p">,</span> <span class="n">substring</span><span class="o">=</span><span class="s2">&quot;lonlat&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">    </span><span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span> <span class="o">=</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span> <span class="o">*</span> <span class="n">RADIANS_TO_DEGREES</span>
    <span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span> <span class="o">=</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span> <span class="o">*</span> <span class="n">RADIANS_TO_DEGREES</span>

  <span class="n">endif</span>

  <span class="c">! now update the grid boundaries based on the transformed coordinate values</span>
  <span class="n">pGrd</span><span class="p">%</span><span class="n">rGridCellSize</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span><span class="p">)</span> <span class="o">-</span> <span class="nb">minval</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span><span class="p">)</span> <span class="p">)</span> <span class="p">&amp;</span>
             <span class="o">/</span> <span class="kt">real</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">iNX</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kt">c_double</span><span class="p">)</span>

  <span class="n">pGrd</span><span class="p">%</span><span class="n">rX0</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span><span class="p">)</span> <span class="o">-</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rGridCellSize</span> <span class="o">/</span> <span class="mi">2_c_float</span>
  <span class="n">pGrd</span><span class="p">%</span><span class="n">rX1</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">rX</span><span class="p">)</span> <span class="o">+</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rGridCellSize</span> <span class="o">/</span> <span class="mi">2_c_float</span>
  <span class="n">pGrd</span><span class="p">%</span><span class="n">rY0</span> <span class="o">=</span> <span class="nb">minval</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span><span class="p">)</span> <span class="o">-</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rGridCellSize</span> <span class="o">/</span> <span class="mi">2_c_float</span>
  <span class="n">pGrd</span><span class="p">%</span><span class="n">rY1</span> <span class="o">=</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">pGrd</span><span class="p">%</span><span class="n">rY</span><span class="p">)</span> <span class="o">+</span> <span class="n">pGrd</span><span class="p">%</span><span class="n">rGridCellSize</span> <span class="o">/</span> <span class="mi">2_c_float</span>

  <span class="c">! finally, change the projection string to reflect the new coordinate system</span>
  <span class="n">pGrd</span><span class="p">%</span><span class="n">sPROJ4_string</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sToPROJ4</span><span class="p">)</span>

  <span class="c">! at this point, what we have is the same old values that were read into the</span>
  <span class="c">! input grid, but a new set of coordinate and boundary definitions that reference</span>
  <span class="c">! the SWB grid projection.</span>

<span class="k">end subroutine </span><span class="n">grid_Transform</span>
</pre></div>

    </section>
    <br>
    

    </div>
  </div>


    <hr>
  </div> <!-- /container -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-2">
          <p>&copy; 2019 <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
            </p>
        </div>
        <div class="col-4">
          <p class="text-right"><small>
            Documentation for SWB2
               (version 2.0, build 96) generated by
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on Tue Sep  3 16:54:50 2019 </small>
          </p>
        </div>
        <div class="col">
          <p class="text-center"> SWB2 was developed by Steve Westenbroek, John Engott, Vic Kelson, Randall Hunt</p>
        </div>
      </div>
      <br>
    </div> <!-- /container -->
  </footer>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
  <script src="../js/bootstrap.min.js"></script>

  <!-- MathJax JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
  

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  

</body>

</html>